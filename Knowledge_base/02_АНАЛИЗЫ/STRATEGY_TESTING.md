# Стратегия тестирования модифицированных приложений для T18FL3

## Цель

Создать пакет обновления с модифицированными приложениями/сервисами и протестировать его перед установкой в реальный автомобиль.

## Проблема

Текущее ядро из автомобиля не запускается в QEMU из-за проблем с инициализацией (SIGSEGV в GIC, проблемы с earlycon и т.д.).

## Рекомендуемая стратегия: Гибридный подход

### Этап 1: Быстрое тестирование приложений (СЕЙЧАС)

**Использовать рабочее Android ядро для быстрого тестирования приложений**

#### Преимущества:

- ✅ Быстрый запуск - можно тестировать приложения сразу
- ✅ Стабильная работа - не нужно отлаживать низкоуровневые проблемы
- ✅ Фокус на приложениях - можно сразу тестировать модификации

#### Что использовать:

1. **Стандартное Android ядро для ARM64** (например, из AOSP или готового образа)

   - Подойдет любое ядро с поддержкой ARM64 и базовых драйверов
   - Можно использовать ядро из другого Android устройства с похожим SoC

2. **Ваша оригинальная system.img** - это самое важное!

   - Все ваши приложения, сервисы, конфигурации
   - Все зависимости и библиотеки
   - Все системные настройки

3. **Ваша оригинальная vendor.img** - драйверы и HAL
   - Специфичные для автомобиля компоненты
   - CAN-шина, дисплеи, аудио

#### Что НЕ критично для тестирования приложений:

- ❌ Точное ядро из автомобиля (для тестирования приложений не нужно)
- ❌ Точные адреса памяти (приложения работают на уровне Android)
- ❌ Низкоуровневые драйверы (если они не используются приложениями)

### Этап 2: Финальное тестирование (ПОЗЖЕ)

**Использовать оригинальное ядро для финальной проверки**

После того, как приложения протестированы и работают:

- Исправить проблемы с QEMU для оригинального ядра
- Провести финальную проверку на максимально точной эмуляции
- Убедиться, что все работает как в реальном автомобиле

## Практическая реализация

### Вариант A: Использовать готовый Android образ (РЕКОМЕНДУЕТСЯ)

1. **Взять базовый Android образ** (например, LineageOS для ARM64 или готовый AOSP образ)
2. **Заменить system.img на вашу** - все ваши приложения и настройки
3. **Заменить vendor.img на вашу** - специфичные драйверы
4. **Оставить kernel из базового образа** - он будет работать в QEMU

**Преимущества:**

- Работает сразу, без отладки
- Можно тестировать приложения немедленно
- Все ваши модификации приложений будут работать

**Недостатки:**

- Некоторые низкоуровневые функции могут отличаться
- Но для тестирования приложений это не критично

### Вариант B: Исправить текущее ядро (ДОЛГОСРОЧНО)

Продолжить исправление QEMU машины для оригинального ядра:

- Исправить SIGSEGV в GIC
- Настроить earlycon для вывода логов
- Исправить все проблемы с инициализацией

**Преимущества:**

- Максимально точная эмуляция
- Все работает как в реальном автомобиле

**Недостатки:**

- Требует много времени на отладку
- Задерживает тестирование приложений

## Рекомендация

**Используйте Вариант A для начала:**

1. **Сейчас:** Возьмите рабочее Android ядро, замените system.img/vendor.img на ваши
2. **Тестируйте приложения:** Модифицируйте, тестируйте, отлаживайте
3. **Создавайте пакет обновления:** Когда приложения готовы
4. **Позже:** Исправьте QEMU для оригинального ядра для финальной проверки

## Что нужно для тестирования приложений

### Критично:

- ✅ Ваша system.img (приложения, сервисы, настройки)
- ✅ Ваша vendor.img (драйверы, HAL)
- ✅ Рабочее Android окружение (любое ядро, которое запускается)

### Не критично для тестирования приложений:

- ❌ Точное ядро из автомобиля
- ❌ Точные адреса памяти
- ❌ Низкоуровневые драйверы (если не используются приложениями)

## Создание пакета обновления

После тестирования приложений:

1. **Модифицируйте приложения** в system.img
2. **Создайте delta-обновление** (только измененные файлы)
3. **Создайте OTA пакет** с вашими изменениями
4. **Установите в реальный автомобиль**

Важно: Пакет обновления будет использовать оригинальное ядро автомобиля, поэтому если вы тестировали на другом ядре, это не проблема - приложения работают на уровне Android, а не ядра.

## Вывод

**Для вашей цели (тестирование модифицированных приложений) использование рабочего ядра - правильный выбор.**

Это позволит:

- Начать тестирование немедленно
- Сфокусироваться на приложениях, а не на низкоуровневой отладке
- Быстрее создать рабочий пакет обновления

Исправление QEMU для оригинального ядра можно делать параллельно, но это не блокирует тестирование приложений.

