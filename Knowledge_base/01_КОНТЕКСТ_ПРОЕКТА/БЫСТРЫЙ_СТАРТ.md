# Быстрый старт - восстановление контекста

## Что нужно знать для продолжения работы

### Текущая задача
Декомпиляция и анализ APK файлов для понимания механизма передачи данных навигации в штатной системе автомобиля.

### Где находятся файлы
- **APK**: `development/extracted_from_device/*.apk`
- **Декомпилированный код**: `development/extracted_from_device/decompiled/`
- **Скрипты**: `development/scripts/`

### Ключевые команды

#### ADB (если нужно переподключиться)
```bash
# Проверка подключения
adb devices

# Подключение по Wi-Fi (если нужно)
adb tcpip 5555
adb connect <IP>:5555

# Извлечение APK
adb shell pm path com.astrob.turbodog
adb pull /data/app/.../base.apk
```

#### Декомпиляция
```bash
# Windows
.\development\scripts\decompile_apks.ps1

# Mac/Linux
./development/scripts/decompile_apks.sh
```

### Что искать в декомпилированном коде

#### В TurboDog (`com.astrob.turbodog`):
1. **Broadcast отправка**:
   - Поиск `sendBroadcast`, `sendOrderedBroadcast`
   - Действие `turbodog.navigation.system.message`
   - Структура Intent extras

2. **ContentProvider**:
   - Классы, наследующие `ContentProvider`
   - URI схемы
   - Методы `query`, `insert`, `update`

3. **SharedPreferences**:
   - Использование `getSharedPreferences`
   - Ключи для данных навигации

4. **Файлы**:
   - Запись в `/data/data/com.astrob.turbodog/`
   - Формат данных (JSON, XML, бинарный)

5. **Сервисы**:
   - Классы, наследующие `Service`
   - `IntentService` для фоновых задач

#### В системных приложениях:
- Как они получают данные от TurboDog
- Какие broadcast'ы слушают
- Какие ContentProvider'ы используют

### Структура данных навигации

Класс `NavigationData` ожидает:
```java
- remainingDistance: Double (метры)
- maneuverDistance: Double (метры)
- maneuverType: String ("LEFT", "RIGHT", "STRAIGHT", "UTURN")
- speedLimit: Integer (км/ч)
- currentRoad: String
- nextRoad: String
- currentLat: Double
- currentLon: Double
- travelTime: Integer (минуты)
- remainingTime: Integer (секунды)
- arriveTime: String
```

### Следующие шаги после декомпиляции

1. **Поиск broadcast'ов**:
   ```bash
   grep -r "sendBroadcast" development/extracted_from_device/decompiled/com.astrob.turbodog/
   grep -r "turbodog.navigation" development/extracted_from_device/decompiled/
   ```

2. **Поиск ContentProvider**:
   ```bash
   grep -r "extends ContentProvider" development/extracted_from_device/decompiled/
   grep -r "query(" development/extracted_from_device/decompiled/com.astrob.turbodog/
   ```

3. **Поиск SharedPreferences**:
   ```bash
   grep -r "getSharedPreferences" development/extracted_from_device/decompiled/com.astrob.turbodog/
   ```

4. **Анализ AndroidManifest.xml**:
   - Найти все `<receiver>`, `<provider>`, `<service>`
   - Проверить разрешения
   - Найти exported компоненты

### Важные файлы проекта

- `BridgeService.java` - главный сервис
- `NavigationDataInterceptor.java` - перехват данных
- `Constants.java` - константы (включая TurboDog extras)
- `NavigationData.java` - модель данных

### Полезные ссылки

- Полный контекст: `development/КОНТЕКСТ_ПРОЕКТА.md`
- История разработки: `development/ИСТОРИЯ_РАЗРАБОТКИ.md`
- ADB команды: `development/КОМАНДЫ_ADB.md`
- Найденные пакеты: `development/НАЙДЕННЫЕ_ПАКЕТЫ.md`

### Если что-то не работает

1. **ADB не видит устройство**:
   - Проверить `adb devices`
   - Перезапустить ADB: `adb kill-server && adb start-server`
   - Проверить авторизацию на устройстве

2. **JADX не найден**:
   - Установить: `.\development\scripts\install_jadx.ps1`
   - Или скачать вручную с GitHub

3. **Декомпиляция падает**:
   - Проверить размер APK (слишком большие могут не декомпилироваться)
   - Попробовать JADX GUI вручную
   - Использовать другие декомпиляторы (jadx-cli, jadx-gui, apktool)

### Контакты и заметки

- Идеи по дизайну: `development/ИДЕИ_ПО_ДИЗАЙНУ.md`
- Скриншоты UI: `development/screenshots/system_ui/`

---

**Последнее обновление**: В процессе декомпиляции APK файлов

