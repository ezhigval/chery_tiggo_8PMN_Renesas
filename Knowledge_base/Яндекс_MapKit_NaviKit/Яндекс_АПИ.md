# Полная документация Yandex MapKit/NaviKit API

## Источники документации

- [MapKit для Android](https://yandex.com/maps-api/docs/mapkit/android/index.html)
- [NaviKit для Android](https://yandex.com/maps-api/docs/navikit/android/index.html)
- [Guidance API](https://yandex.com/maps-api/docs/mapkit/android/generated/navigation/guidance.html)
- [Windshield API](https://yandex.com/maps-api/docs/mapkit/android/generated/navigation/windshield.html)
- [DrivingRoute API](https://yandex.com/maps-api/docs/mapkit/android/generated/navigation/drivingroute.html)

## Стратегия перехвата данных

### Принцип работы:

1. **Находим места вызова API** - где Yandex Maps вызывает методы API (например, `getLegalSpeedLimit()`)
2. **Находим места сохранения** - где результаты сохраняются в переменные/поля (например, `legalSpeedLimit = ...`)
3. **Перехватываем данные** - модифицируем код для отправки данных в BridgeService
4. **Разворачиваем в BridgeService** - преобразуем сырые данные в итоговые значения

### Преимущества:

- ✅ Данные динамические и асинхронные (получаем сразу при обновлении)
- ✅ Не нужно использовать Reflection на готовых объектах
- ✅ Проще и быстрее
- ✅ Работает с внутренними переменными приложения

## Места для перехвата данных

### 1. Ограничение скорости

**Ищем:**

- Вызовы `getLegalSpeedLimit()`, `getSpeedLimit()`, `getSpeedLimitStatus()`
- Сохранение в переменные: `speedLimit`, `legalSpeedLimit`, `currentSpeedLimit`
- Обновление UI с ограничением скорости

**Перехватываем:**

```java
// В месте где сохраняется результат:
legalSpeedLimit = guidance.getLegalSpeedLimit();
// Добавляем:
sendSpeedLimitToBridge(legalSpeedLimit);
```

### 2. Маневры

**Ищем:**

- Вызовы `getUpcomingManoeuvres()`, `getNextManeuver()`
- Сохранение в переменные: `manoeuvres`, `nextManeuver`, `upcomingManoeuvres`
- Обновление UI с маневрами

**Перехватываем:**

```java
// В месте где сохраняется результат:
upcomingManoeuvres = windshield.getUpcomingManoeuvres();
// Добавляем:
sendManoeuvresToBridge(upcomingManoeuvres);
```

### 3. Маршрут (геометрия)

**Ищем:**

- Вызовы методов получения геометрии маршрута
- Сохранение полилиний/точек маршрута
- Обновление карты с маршрутом

**Перехватываем:**

```java
// В месте где сохраняется геометрия:
routeGeometry = route.getGeometry();
// Добавляем:
sendRouteGeometryToBridge(routeGeometry);
```

### 4. Карта (отрисовка)

**Ищем:**

- Вызовы методов получения тайлов карты
- Сохранение данных тайлов
- Отрисовка карты (дороги, здания)

**Перехватываем:**

```java
// В месте где получаются тайлы:
mapTiles = mapTileProvider.getTiles();
// Добавляем:
sendMapTilesToBridge(mapTiles);
```

### 5. События на карте

**Ищем:**

- Вызовы методов получения событий (камеры, пробки)
- Сохранение событий в списки
- Обновление карты с событиями

**Перехватываем:**

```java
// В месте где сохраняются события:
mapEvents = annotator.getEvents();
// Добавляем:
sendMapEventsToBridge(mapEvents);
```

## План действий

1. ⏳ Декомпилировать Yandex Maps APK
2. ⏳ Найти места вызова API методов
3. ⏳ Найти места сохранения результатов
4. ⏳ Модифицировать код для перехвата данных
5. ⏳ Отправлять данные в BridgeService
6. ⏳ Разворачивать данные в BridgeService
