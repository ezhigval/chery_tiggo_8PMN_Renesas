# План создания собственного навигатора на Yandex MapKit SDK

## Цель

Создать собственное приложение-навигатор на основе официального Yandex MapKit SDK, которое:
1. Использует официальный API для навигации
2. Автоматически отправляет данные нашему мосту (`TiggoBridgeService`) в формате TurboDog
3. Работает как полноценный навигатор с картами и маршрутизацией

## Преимущества подхода

✅ **Легальность:** Используем официальный SDK, не нарушаем лицензию  
✅ **Надежность:** Полный контроль над отправкой данных  
✅ **Стабильность:** Не зависит от обновлений оригинального Yandex Navigator  
✅ **Гибкость:** Можем добавить любые функции для интеграции с автомобилем  

## Варианты реализации

### Вариант 1: Полностью собственный навигатор (Рекомендуется)

**Описание:** Создать новое приложение с нуля на основе Yandex MapKit SDK

**Преимущества:**
- Полный контроль над UI и функциональностью
- Можем оптимизировать под автомобильный интерфейс
- Легко добавлять функции интеграции с QNX

**Недостатки:**
- Больше работы по разработке UI
- Нужно реализовать все функции навигации

**Структура проекта:**
```
TiggoNavigator/
├── app/
│   ├── src/main/java/com/desaysv/tiggo/navigator/
│   │   ├── MainActivity.java          # Главный экран с картой
│   │   ├── NavigationService.java     # Сервис навигации
│   │   ├── RouteBuilder.java          # Построение маршрутов
│   │   ├── GuidanceListener.java      # Слушатель навигации
│   │   └── SystemDataSender.java     # Отправка данных в QNX
│   └── build.gradle                   # Зависимости MapKit SDK
```

### Вариант 2: Модификация Yandex Navigator APK

**Описание:** Декомпилировать, модифицировать и пересобрать APK

**Преимущества:**
- Сохраняем весь UI и функциональность оригинального навигатора
- Меньше работы по разработке

**Недостатки:**
- ⚠️ Нарушает лицензию Yandex Navigator
- APK может быть обфусцирован и защищен
- Требует обновления при каждом обновлении навигатора
- Сложно технически (ре-компиляция, подпись)

**Процесс:**
1. Декомпиляция APK (JADX)
2. Поиск места, где навигатор получает данные
3. Добавление кода отправки в наш мост
4. Ре-компиляция APK
5. Подпись и установка

### Вариант 3: Гибридный подход

**Описание:** Создать минималистичный навигатор, который использует Yandex Navigator для UI, но сам управляет навигацией

**Преимущества:**
- Используем официальный SDK для навигации
- Можем использовать простой UI
- Полный контроль над данными

**Недостатки:**
- Нужно разработать базовый UI

## Рекомендуемый подход: Вариант 1

### Этап 1: Настройка проекта

1. **Создать новый Android проект:**
   ```bash
   # В Android Studio создать новый проект
   # Package: com.desaysv.tiggo.navigator
   # Minimum SDK: 26 (Android 8.0)
   # Target SDK: 28 (Android 9.0)
   ```

2. **Добавить зависимости MapKit SDK:**
   ```gradle
   // build.gradle (app)
   repositories {
       maven {
           url 'https://maven.yandex.ru/mapkit'
       }
   }
   
   dependencies {
       implementation 'com.yandex.android:mapkit:3.5.0'
       implementation 'com.yandex.android:search:3.5.0'
       implementation 'com.yandex.android:directions:3.5.0'
       implementation 'com.yandex.android:transport:3.5.0'
   }
   ```

3. **Получить API ключ:**
   - Зарегистрироваться на https://yandex.ru/dev/
   - Создать приложение
   - Получить API ключ для MapKit

### Этап 2: Реализация навигации

1. **Инициализация MapKit:**
   ```java
   MapKitFactory.setApiKey("YOUR_API_KEY");
   MapKitFactory.initialize(context);
   ```

2. **Создание карты:**
   ```java
   MapView mapView = findViewById(R.id.mapview);
   mapView.getMap().move(
       new CameraPosition(new Point(55.751574, 37.573856), 11.0f, 0.0f, 0.0f),
       new Animation(Animation.Type.SMOOTH, 0),
       null
   );
   ```

3. **Построение маршрута:**
   ```java
   Router router = MapKitFactory.getInstance().createRouter(RouterType.DRIVING);
   Session session = router.requestRoutes(
       requestPoints,
       new DrivingOptions(),
       new VehicleOptions(),
       this  // Session.RouteListener
   );
   ```

4. **Запуск навигации:**
   ```java
   Guidance guidance = MapKitFactory.getInstance().createGuidance();
   guidance.start(route);
   guidance.addGuidanceListener(this);  // GuidanceListener
   ```

### Этап 3: Интеграция с мостом

1. **Создать SystemDataSender:**
   ```java
   public class SystemDataSender {
       private static final String ACTION = "turbodog.navigation.system.message";
       
       public void sendNavigationData(Guidance guidance, Context context) {
           NextManeuver maneuver = guidance.getNextManeuver();
           DrivingRoute route = guidance.route();
           
           Intent intent = new Intent(ACTION);
           intent.putExtra("CODE", 201);
           intent.putExtra("TURN_TYPE", maneuver.getType());
           intent.putExtra("TURN_DIST", maneuver.getDistance());
           // ... остальные данные
           
           context.sendBroadcast(intent);
       }
   }
   ```

2. **Подписаться на обновления:**
   ```java
   @Override
   public void onRoutePositionUpdated() {
       // Отправить данные в мост
       systemDataSender.sendNavigationData(guidance, context);
   }
   ```

### Этап 4: UI для автомобиля

1. **Создать автомобильный интерфейс:**
   - Большие кнопки для управления
   - Минималистичный дизайн
   - Поддержка темной темы
   - Оптимизация для сенсорного управления

2. **Интеграция с системой:**
   - Автозапуск при старте автомобиля
   - Интеграция с системными настройками
   - Поддержка голосового управления (опционально)

## Альтернатива: Минималистичный навигатор

Если полная разработка UI слишком сложна, можно создать минималистичный навигатор:

1. **Простой UI:**
   - Карта (MapView)
   - Кнопка "Построить маршрут"
   - Кнопка "Начать навигацию"
   - Индикатор текущей навигации

2. **Фокус на функциональности:**
   - Все функции навигации работают
   - Автоматическая отправка данных в мост
   - Минимальный UI для управления

## Сравнение с модификацией APK

| Критерий | Собственный навигатор | Модификация APK |
|----------|----------------------|-----------------|
| Легальность | ✅ Легально | ❌ Нарушает лицензию |
| Надежность | ✅ Стабильно | ⚠️ Зависит от обновлений |
| Сложность | Средняя | Высокая |
| Поддержка | ✅ Полный контроль | ❌ Нужно обновлять |
| Функциональность | ✅ Любая | ⚠️ Ограничена оригиналом |

## Рекомендация

**Создать собственный минималистичный навигатор** на основе Yandex MapKit SDK:

1. ✅ Используем официальный SDK (легально)
2. ✅ Полный контроль над отправкой данных
3. ✅ Не зависит от обновлений Yandex Navigator
4. ✅ Можем оптимизировать под автомобиль
5. ✅ Проще поддерживать и обновлять

## Следующие шаги

1. **Изучить документацию MapKit SDK:**
   - https://yandex.ru/dev/mapkit/doc/android/
   - Примеры использования
   - API Reference

2. **Создать тестовый проект:**
   - Настроить MapKit SDK
   - Создать простую карту
   - Построить тестовый маршрут

3. **Реализовать отправку данных:**
   - Интегрировать с `TiggoBridgeService`
   - Отправлять данные в формате TurboDog

4. **Разработать UI:**
   - Минималистичный интерфейс
   - Оптимизация для автомобиля

## Полезные ссылки

- **Yandex для разработчиков:** https://yandex.ru/dev/
- **MapKit SDK:** https://yandex.ru/dev/mapkit/doc/android/
- **Примеры:** Искать в документации или GitHub

## Важные замечания

⚠️ **Модификация APK Yandex Navigator нарушает лицензионное соглашение.**

✅ **Использование официального MapKit SDK полностью легально и рекомендуется.**

