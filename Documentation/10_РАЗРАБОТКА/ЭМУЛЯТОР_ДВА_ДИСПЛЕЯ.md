# Работа с двумя дисплеями в Android Emulator

## Выводы исследования

### Поддержка двух дисплеев в Android Emulator

**Android Emulator (стандартный эмулятор Android Studio) НЕ поддерживает два физических дисплея напрямую.**

Хотя в эмуляторе есть параметры:
- `-multidisplay index width height dpi flag` - для настройки нескольких дисплеев
- `-hotplug-multi-display` - для динамического подключения дисплеев

**На практике эти параметры работают нестабильно или не работают вообще.** При попытке использования возникает ошибка: `invalid command-line parameter`.

### Реальная ситуация на ГУ

На реальном ГУ Chery Tiggo 8 Pro Max T18FL3:
- **Основной дисплей:** 1920x720, 160dpi (встроенный экран)
- **Второй дисплей:** 1920x720, 213dpi, тип HDMI, флаг `FLAG_PRESENTATION` (приборная панель)

Второй дисплей определяется системой как:
```
DisplayDeviceInfo{"Экран HDMI": uniqueId="local:1", 1920 x 720, 
type HDMI, FLAG_PRESENTATION}
```

## Обходной путь: Presentation API

Для тестирования приложений с двумя дисплеями в эмуляторе используйте **Presentation API** - стандартный способ работы с дополнительными дисплеями в Android.

### Как это работает

1. **В эмуляторе:** Запускается один физический дисплей
2. **В приложении:** Создается виртуальный дисплей через Presentation API
3. **Результат:** Приложение может работать с двумя дисплеями, как на реальном ГУ

### Пример кода

```java
public class MainActivity extends AppCompatActivity {
    private Presentation presentation;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        
        // Найти второй дисплей
        DisplayManager displayManager = (DisplayManager) getSystemService(Context.DISPLAY_SERVICE);
        Display[] displays = displayManager.getDisplays();
        
        Display secondaryDisplay = null;
        for (Display display : displays) {
            if (display.getDisplayId() != Display.DEFAULT_DISPLAY) {
                // Проверить, что это presentation display
                if ((display.getFlags() & Display.FLAG_PRESENTATION) != 0) {
                    secondaryDisplay = display;
                    break;
                }
            }
        }
        
        // Создать Presentation для второго дисплея
        if (secondaryDisplay != null) {
            presentation = new Presentation(this, secondaryDisplay);
            presentation.setContentView(R.layout.presentation_layout);
            presentation.show();
        }
    }
    
    @Override
    protected void onDestroy() {
        super.onDestroy();
        if (presentation != null) {
            presentation.dismiss();
        }
    }
}
```

### Создание виртуального дисплея программно

Если нужно создать виртуальный дисплей программно:

```java
DisplayManager displayManager = (DisplayManager) getSystemService(Context.DISPLAY_SERVICE);

// Параметры виртуального дисплея
int width = 1920;
int height = 720;
int densityDpi = 213;
String name = "HDMI Display";

VirtualDisplay virtualDisplay = displayManager.createVirtualDisplay(
    name,
    width,
    height,
    densityDpi,
    null,
    DisplayManager.VIRTUAL_DISPLAY_FLAG_PRESENTATION
);
```

## Настройка эмуляторов

### Два эмулятора для тестирования

Для тестирования созданы два эмулятора:

1. **Tiggo_T18FL3** (порт 5554)
   - Основной эмулятор для разработки
   - Один дисплей: 1920x720, 160dpi

2. **Tiggo_T18FL3_dual** (порт 5556)
   - Эмулятор для тестирования Presentation API
   - Один дисплей: 1920x720, 160dpi
   - Второй дисплей создается через Presentation API в приложении

### Запуск эмуляторов

```bash
# Первый эмулятор
cd ai_scripts/AVM/scripts
./start_avd.sh

# Второй эмулятор (в отдельном терминале)
./start_avd_dual.sh
```

### Работа с ADB

```bash
# Подключение к первому эмулятору
adb -s emulator-5554 <команда>

# Подключение ко второму эмулятору
adb -s emulator-5556 <команда>

# Проверка всех устройств
adb devices
```

## Альтернативные решения

### 1. Genymotion

Genymotion - сторонний эмулятор, который может поддерживать расширенные настройки дисплеев. Однако для тестирования Presentation API стандартный эмулятор Android Studio достаточен.

### 2. Тестирование на реальном устройстве

Для финального тестирования рекомендуется использовать реальное ГУ, где второй дисплей (приборная панель) подключен через HDMI и определяется системой автоматически.

## Рекомендации

1. **Для разработки:** Используйте один эмулятор (Tiggo_T18FL3) с Presentation API
2. **Для тестирования:** Используйте второй эмулятор (Tiggo_T18FL3_dual) для изоляции тестов
3. **Для финальной проверки:** Тестируйте на реальном ГУ

## Ссылки

- [Presentation API Documentation](https://developer.android.com/reference/android/app/Presentation)
- [DisplayManager Documentation](https://developer.android.com/reference/android/hardware/display/DisplayManager)
- [VirtualDisplay Documentation](https://developer.android.com/reference/android/hardware/display/DisplayManager#createVirtualDisplay(java.lang.String,%20int,%20int,%20int,%20int,%20android.view.Surface,%20int))

## Скрипты

Все скрипты для работы с эмуляторами находятся в:
- `ai_scripts/AVM/scripts/`

Подробная инструкция по настройке AVD:
- `Knowledge_base/04_ИНСТРУКЦИИ/НАСТРОЙКА_AVD_ANDROID_STUDIO.md`

