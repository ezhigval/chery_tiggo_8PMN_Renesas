# Инструкция по сборке TiggoBridgeService

## Что собираем?

**TiggoBridgeService** - основное приложение-мост, которое:
- Перехватывает данные навигации от Yandex Navigator через NotificationListenerService
- Отправляет данные в QNX (приборную панель автомобиля)
- Автоматически включает NotificationListenerService при запуске

## Путь к проекту

```
development/projects/TiggoBridgeService
```

## Способ 1: Через Android Studio (РЕКОМЕНДУЕТСЯ)

### Шаг 1: Открыть проект
1. Запустите **Android Studio**
2. **File** → **Open**
3. Выберите папку: `development/projects/TiggoBridgeService`
4. Дождитесь синхронизации Gradle

### Шаг 2: Собрать APK
1. **Build** → **Make Project** (или `Cmd+B` / `Ctrl+B`)
2. Дождитесь завершения сборки
3. APK будет в: `app/build/outputs/apk/debug/app-debug.apk`

### Шаг 3: Установить на устройство
```bash
adb install -r development/projects/TiggoBridgeService/app/build/outputs/apk/debug/app-debug.apk
```

## Способ 2: Через Gradle (командная строка)

### Если есть проблемы с AAPT2:
```bash
cd development/projects/TiggoBridgeService
./gradlew clean
./gradlew assembleDebug
```

### Если сборка успешна:
APK будет в: `app/build/outputs/apk/debug/app-debug.apk`

### Установка:
```bash
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

## Что включено в сборку

✅ **NotificationListenerService** - перехват уведомлений навигации  
✅ **NotificationListenerHelper** - автоматическое включение сервиса  
✅ **NotificationDataParser** - парсинг данных из уведомлений  
✅ **BridgeService** - главный сервис для отправки данных в QNX  
✅ **NavigationMonitor** - мониторинг состояния навигатора  
✅ **SystemSender** - отправка данных в систему автомобиля  

## Проверка сборки

После установки проверьте:
```bash
# Проверить, что приложение установлено
adb shell pm list packages | grep tiggo

# Проверить логи при запуске
adb logcat | grep -E "(BridgeService|NotificationListenerHelper)"
```

## Следующие шаги после установки

1. **Запустите приложение** - оно автоматически попытается включить NotificationListenerService
2. **Проверьте логи** - должны быть сообщения о статусе NotificationListenerService
3. **Запустите навигацию** - постройте маршрут в Yandex Navigator
4. **Проверьте данные** - в логах должны появиться сообщения о перехвате уведомлений

## Устранение проблем

### Ошибка сборки: AAPT2 not found
- Используйте Android Studio для сборки
- Или обновите Android SDK Build Tools

### Ошибка: WRITE_SECURE_SETTINGS permission
- Это нормально для обычных приложений
- На системных приложениях (автомобильное ГУ) должно работать
- Если не работает - используйте ADB команду из логов

### APK не устанавливается
```bash
# Удалить старое приложение
adb uninstall com.desaysv.tiggo.bridge

# Установить заново
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

