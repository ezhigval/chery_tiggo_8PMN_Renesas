# План исследования TurboDog и штатной системы навигации

## Цель
Понять, как работает штатная система TurboDog, чтобы сделать "бесшовную" подмену на Яндекс Навигатор.

---

## Текущая ситуация

### Известно:
1. **SVMapService.apk** - основной сервис навигации
   - Поддерживает AutoNavi (китайский навигатор)
   - Поддерживает Thinkware (корейский навигатор)
   - Использует Broadcast для коммуникации с QNX
   - Protected Broadcasts: `AUTONAVI_STANDARD_BROADCAST_RECV`, `THINKWARE_TO_QNX_BROADCAST_RECV`

2. **SVMeterInteraction.apk** - взаимодействие с приборной панелью
   - Отвечает за отображение данных на приборной панели
   - Запускается очень рано (directBootAware)
   - Высокий приоритет при загрузке

3. **Формат Broadcast Intent:**
   - `turbodog.navigation.system.message` - отправка навигационных данных
   - `desay.broadcast.map.meter.interaction` - управление навигацией

4. **TurboDog данные:**
   - Найдены в обновлении прошивки (T18FL3)
   - Только данные карт, не само приложение
   - Расположение: `T18FL3 ... MAPS/TurboDog/`

### Проблема:
- TurboDog приложение не найдено в extracted системных приложений
- SVMapService обфусцирован или использует нативный код
- Исходный код не извлекается через JADX

---

## План исследования

### Этап 1: Поиск TurboDog приложения

1. **Проверить обновление прошивки:**
   - Изучить структуру `soc_update.zip`
   - Найти APK файлы в обновлении
   - Проверить, есть ли TurboDog в обновлении

2. **Поиск в других местах:**
   - Проверить пользовательские приложения
   - Проверить системные разделы (если доступны)
   - Поиск по package name: `com.autonavi`, `com.turbodog`, `com.amap`

3. **Анализ SVMapService:**
   - TurboDog может быть встроен в SVMapService
   - Или использовать нативные библиотеки (.so файлы)
   - Проверить зависимости и ссылки

### Этап 2: Декомпиляция и анализ

1. **SVMapService:**
   - Попробовать более агрессивную декомпиляцию
   - Изучить нативные библиотеки (.so файлы)
   - Анализ ресурсов и строк
   - Поиск строковых констант (Broadcast actions, package names)

2. **SVMeterInteraction:**
   - Аналогичный анализ
   - Поиск ссылок на Broadcast Intents
   - Поиск методов обработки данных

3. **Другие компоненты:**
   - Проверить все системные приложения на ссылки на навигацию
   - Найти все Broadcast Receivers, которые слушают навигационные события

### Этап 3: Прослеживание цепочки коммуникации

1. **От навигатора к системе:**
   - Как TurboDog отправляет данные?
   - Какие Broadcast Intents использует?
   - Какие System Properties устанавливает?
   - Использует ли Shared Memory или Unix Sockets?

2. **От системы к приборной панели:**
   - Как SVMeterInteraction получает данные?
   - Как данные передаются в QNX?
   - Какие форматы данных используются?

3. **Обратная связь:**
   - Как система управляет навигацией?
   - Какие команды отправляются навигатору?

### Этап 4: Документирование форматов

1. **Broadcast Intents:**
   - Все actions и extras
   - Формат данных для каждого типа сообщения
   - Коды сообщений и их значения

2. **System Properties:**
   - Какие свойства используются?
   - Формат значений
   - Кто читает и кто пишет

3. **Данные карты:**
   - Формат отправки карты на приборную панель
   - Размеры и разрешение
   - Частота обновления

4. **Ограничение скорости:**
   - Как отправляется ограничение скорости?
   - Где хранится значение из настроек?
   - Как подменить значение?

---

## Методы исследования

### 1. Статический анализ
- Декомпиляция APK (JADX, jadx-gui)
- Анализ AndroidManifest.xml
- Поиск строковых констант
- Анализ ресурсов

### 2. Динамический анализ (если есть доступ к устройству)
- Логирование Broadcast Intents (logcat)
- Мониторинг System Properties
- Трассировка системных вызовов
- Перехват сетевого трафика (если есть)

### 3. Обратная инженерия
- Анализ нативных библиотек (.so файлы)
- Поиск паттернов в коде
- Сравнение с известными форматами (AutoNavi, Thinkware)

---

## Следующие шаги

### Немедленно:
1. ✅ Попробовать более агрессивную декомпиляцию SVMapService
2. ⏳ Проверить наличие .so файлов в SVMapService и SVMeterInteraction
3. ⏳ Изучить структуру soc_update.zip
4. ⏳ Поиск строковых констант в декомпилированных файлах

### Затем:
1. Найти все Broadcast Receivers, которые слушают навигационные события
2. Найти все ссылки на package names навигаторов
3. Документировать все найденные форматы данных
4. Создать карту коммуникации между компонентами

---

## Ожидаемые результаты

1. **Полное понимание формата данных:**
   - Все поля Broadcast Intent
   - Формат данных для карты
   - Формат данных для ограничения скорости

2. **Карта коммуникации:**
   - От навигатора к системе
   - От системы к приборной панели
   - Обратная связь

3. **План интеграции:**
   - Как извлечь данные из Яндекс Навигатора
   - Как преобразовать в формат TurboDog
   - Как отправить в систему

---

**Дата:** 2024  
**Версия:** 1.0

