# Инструкция для продолжения работы на виртуальной машине

## Дата создания: 13.11.2024

## Что нужно сделать

### 1. Установить Yandex Maps на виртуальную машину

```bash
# APK сохранен в:
development/apk/yandex_maps_from_device.apk

# Установить:
adb install -r development/apk/yandex_maps_from_device.apk
```

### 2. Запустить приложение и проверить логи

```bash
# Очистить логи
adb logcat -c

# Запустить мониторинг
adb logcat | grep -E "(NotificationDataManager|Guidance|YandexNavigatorDataExtractor|Consumer|onHandlerReady)" --line-buffered

# В другом терминале запустить приложение
adb shell am start -n com.desaysv.tiggo.bridge/.ui.MainActivity
```

### 3. Запустить навигацию в Yandex Maps

1. Открыть Yandex Maps
2. Построить маршрут
3. Начать навигацию
4. Наблюдать за логами

### 4. Проверить NotificationListenerService

```bash
# Проверить, включен ли
adb shell settings get secure enabled_notification_listeners

# Включить, если не включен
adb shell settings put secure enabled_notification_listeners com.desaysv.tiggo.bridge/.notification.NavigationNotificationListener
```

## Текущая проблема

Handler, который приходит в `onHandlerReady`, является Proxy. Нужно найти способ получить настоящий Guidance объект, который имеет метод `notificationDataManager()`.

## Что пробовать дальше

1. Изучить декомпилированный код `k.java` - там видно, как получается Guidance
2. Попробовать получить Guidance через уже зарегистрированный consumer в системе
3. Использовать NotificationListenerService как основной метод получения данных

## Файлы для изучения

- `development/extracted_from_device/decompiled/ru.yandex.yandexmaps/sources/ru/yandex/yandexmaps/integrations/auto_navigation/navikit/k.java` - показывает, как consumer получает Guidance
- `development/extracted_from_device/decompiled/ru.yandex.yandexmaps/sources/com/yandex/navikit/guidance/service/GuidanceServicePresenter.java` - структура handler
