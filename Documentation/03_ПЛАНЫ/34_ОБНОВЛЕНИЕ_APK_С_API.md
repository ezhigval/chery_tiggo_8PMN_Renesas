# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ APK Yandex Maps —Å API-–ø–æ–¥—Ö–æ–¥–æ–º

## –¶–µ–ª—å
–û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π APK Yandex Maps –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API-–ø–æ–¥—Ö–æ–¥.

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### TiggoBridgeSender (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)

**–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
1. ‚úÖ –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è (–∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫)
2. ‚úÖ –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
3. ‚úÖ –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä—Ç—ã (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É, –¥–∞–∂–µ –±–µ–∑ –º–∞—Ä—à—Ä—É—Ç–∞)
4. ‚úÖ API-–ø–æ–¥—Ö–æ–¥: —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ Actions

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `startContinuousDataSending()` - –∑–∞–ø—É—Å–∫ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- `startMapSending()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä—Ç—ã
- `startLocationSending()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
- `startNavigationSending()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- `attachToMapView(Object mapView)` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MapView

**–ù–æ–≤—ã–µ Actions:**
- `com.desaysv.tiggo.bridge.MAP_DATA` - –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
- `com.desaysv.tiggo.bridge.LOCATION_DATA` - –¥–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
- `com.desaysv.tiggo.bridge.ROUTE_DATA` - –¥–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç–∞
- `com.desaysv.tiggo.bridge.NAVIGATION_DATA` - –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—É–ª—É—á—à–µ–Ω–æ)

## –®–∞–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è APK

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ TiggoBridgeSender

```bash
cd development/projects/TiggoBridgeService

# –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º TiggoBridgeSender.java
javac -cp "$ANDROID_HOME/platforms/android-*/android.jar" \
    -d /tmp/tiggo_bridge \
    app/src/main/java/com/desaysv/tiggo/bridge/navigation/TiggoBridgeSender.java

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º .class –≤ .dex
dx --dex --output=/tmp/tiggo_bridge.dex /tmp/tiggo_bridge

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º .dex –≤ smali
baksmali d /tmp/tiggo_bridge.dex -o /tmp/tiggo_bridge_smali
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ APK

```bash
cd development/apk_modification/yandexmaps_decompiled

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π TiggoBridgeSender
rm -rf smali_classes9/ru/yandex/yandexmaps/bridge/TiggoBridgeSender.smali

# –ö–æ–ø–∏—Ä—É–µ–º –Ω–æ–≤—ã–π
cp -r /tmp/tiggo_bridge_smali/ru/yandex/yandexmaps/bridge/TiggoBridgeSender.smali \
    smali_classes9/ru/yandex/yandexmaps/bridge/
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ k.smali

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 62-70):**
```smali
# === TiggoBridgeSender: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ===
invoke-static {}, Lru/yandex/yandexmaps/bridge/TiggoBridgeSender;->init()V

invoke-static {}, Lru/yandex/yandexmaps/bridge/TiggoBridgeSender;->getInstance()Lru/yandex/yandexmaps/bridge/TiggoBridgeSender;
move-result-object v0
invoke-virtual {v0, p4, p1}, Lru/yandex/yandexmaps/bridge/TiggoBridgeSender;->attachToGuidanceAndNotificationDataManager(Lcom/yandex/navikit/guidance/Guidance;Lcom/yandex/navikit/guidance/NotificationDataManager;)V
# === –ö–æ–Ω–µ—Ü TiggoBridgeSender ===
```

**–≠—Ç–æ—Ç –∫–æ–¥ —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π!** –ú–µ—Ç–æ–¥ `attachToGuidanceAndNotificationDataManager` —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö.

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MapView (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É, –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ MapView –≤ Yandex Maps –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –Ω–µ–º—É.

**–ì–¥–µ –∏—Å–∫–∞—Ç—å MapView:**
- –í –≥–ª–∞–≤–Ω–æ–π Activity Yandex Maps
- –ß–µ—Ä–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è Guidance

**–ö–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–≤ –∫–ª–∞—Å—Å–µ k.smali –∏–ª–∏ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ):**
```smali
# –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å MapView –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
# (–Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏, –≥–¥–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è MapView –≤ Yandex Maps)
```

### 5. –†–µ-–∫–æ–º–ø–∏–ª—è—Ü–∏—è APK

```bash
cd development/apk_modification/yandexmaps_decompiled

# –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º APK
apktool b . -o yandexmaps_modified_v7.apk

# –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º
apksigner sign --ks ../../tiggo_maps.keystore \
    --ks-key-alias tiggo \
    yandexmaps_modified_v7.apk
```

### 6. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
adb uninstall ru.yandex.yandexmaps
adb install yandexmaps_modified_v7.apk
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
adb logcat | grep -E "(LOCATION_DATA|–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ)"

# –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
adb logcat | grep -E "(NAVIGATION_DATA|–ù–∞–≤–∏–≥–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞)"

# –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä—Ç—ã
adb logcat | grep -E "(MAP_DATA|–ö–∞—Ä—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞)"

# –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç TiggoBridgeSender
adb logcat | grep "TiggoBridgeSender"
```

### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:

```
TiggoBridgeSender: –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–∞ (–∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫)
TiggoBridgeSender: –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∑–∞–ø—É—â–µ–Ω–∞ (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
TiggoBridgeSender: –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: 55.7558, 37.6173
TiggoBridgeSender: ‚úì –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã
BridgeService: üîµ –ü–æ–ª—É—á–µ–Ω–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: 55.7558, 37.6173
BridgeService: üîµ –ü–æ–ª—É—á–µ–Ω–∞ –∫–∞—Ä—Ç–∞ –æ—Ç Yandex Maps
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
   - Yandex Maps —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
   - BridgeService –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ QNX

2. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:**
   - –ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è
   - –ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–µ—Ç, –∫–∞—Ä—Ç–∞ –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

3. **–ì–∏–±–∫–æ—Å—Ç—å:**
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
   - –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞

4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏
   - –†–∞–∑–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚úÖ TiggoBridgeSender –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
‚úÖ BridgeService –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø—Ä–∏–µ–º–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
‚úÖ API-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞
‚è≥ –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å APK —Å –Ω–æ–≤—ã–º TiggoBridgeSender
‚è≥ –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MapView (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π TiggoBridgeSender –≤ smali
2. –û–±–Ω–æ–≤–∏—Ç—å APK
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö
4. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MapView –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã

