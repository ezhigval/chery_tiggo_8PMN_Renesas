# –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã –º—É–ª—å—Ç–∏–º–µ–¥–∏–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏

## üìä –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –º—É–ª—å—Ç–∏–º–µ–¥–∏–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

1. **SVMedia** (`com.desaysv.mediaapp`)
   - –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–º–µ–¥–∏–∞
   - UI –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (—Ä–∞–¥–∏–æ, Bluetooth, CarPlay)
   - Activity: `com.desaysv.mediaapp.ui.MediaMainActivity`

2. **SVMediaService** (`com.desaysv.mediaservice`)
   - –§–æ–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–¥–∏–∞
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (Bluetooth, USB, Radio)
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø—Ä–∏–±–æ—Ä–Ω—É—é –ø–∞–Ω–µ–ª—å

3. **SVMediaProvider** (`com.desaysv.mediaprovider`)
   - –ü—Ä–æ–≤–∞–π–¥–µ—Ä –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
   - –î–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (`dialog_source_t1d_my.xml`)

4. **SVMeterInteraction** (`com.desaysv.meterinteraction`)
   - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–∏–±–æ—Ä–Ω–æ–π –ø–∞–Ω–µ–ª—å—é
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ CAN-—à–∏–Ω—É
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ

---

## üéµ –¢–µ–∫—É—â–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –º—É–ª—å—Ç–∏–º–µ–¥–∏–∞

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:

1. **–†–∞–¥–∏–æ (DAB/FM)**
   - DAB Radio (`dabradio_*` layouts)
   - FM Radio
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ/—Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏–∏

2. **Bluetooth**
   - A2DP (Advanced Audio Distribution Profile)
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Bluetooth
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ

3. **CarPlay**
   - Apple CarPlay –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ—Ç iPhone
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ

4. **USB**
   - USB Media Player
   - –ß—Ç–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–æ–≤
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ

### ‚ùå –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:

- **–Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞** - –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- **–î—Ä—É–≥–∏–µ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** - –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã

---

## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ

### –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ):

#### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

**–î–ª—è Bluetooth:**
```java
// SVMediaService –ø–æ–ª—É—á–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ A2DP
BluetoothA2dp a2dp = BluetoothAdapter.getDefaultAdapter().getProfileProxy(
    context, 
    new BluetoothProfile.ServiceListener() {
        @Override
        public void onServiceConnected(int profile, BluetoothProfile proxy) {
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
            MediaMetadata metadata = a2dp.getMetadata();
            String artist = metadata.getString(MediaMetadata.METADATA_KEY_ARTIST);
            String title = metadata.getString(MediaMetadata.METADATA_KEY_TITLE);
            String album = metadata.getString(MediaMetadata.METADATA_KEY_ALBUM);
        }
    },
    BluetoothProfile.A2DP
);
```

**–î–ª—è CarPlay:**
```java
// –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ CarPlay –ø—Ä–æ—Ç–æ–∫–æ–ª
// (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –¥–ª—è Apple CarPlay)
```

**–î–ª—è USB:**
```java
// –ß—Ç–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–æ–≤ (ID3 tags)
MediaMetadataRetriever retriever = new MediaMetadataRetriever();
retriever.setDataSource(filePath);
String artist = retriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_ARTIST);
String title = retriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_TITLE);
```

#### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –ø—Ä–∏–±–æ—Ä–Ω—É—é –ø–∞–Ω–µ–ª—å

**–ß–µ—Ä–µ–∑ Broadcast Intent:**
```java
// SVMediaService –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
Intent intent = new Intent("com.desaysv.mediaservice.TRACK_UPDATE");
intent.putExtra("artist", artist);
intent.putExtra("title", title);
intent.putExtra("album", album);
intent.putExtra("source", "bluetooth"); // –∏–ª–∏ "radio", "usb", "carplay"
sendBroadcast(intent);
```

**–ß–µ—Ä–µ–∑ SVMeterInteraction:**
```java
// SVMeterInteraction –ø–æ–ª—É—á–∞–µ—Ç Broadcast –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ CAN
// Broadcast Receiver –≤ SVMeterInteraction
private BroadcastReceiver mediaReceiver = new BroadcastReceiver() {
    @Override
    public void onReceive(Context context, Intent intent) {
        String artist = intent.getStringExtra("artist");
        String title = intent.getStringExtra("title");
        String album = intent.getStringExtra("album");
        String source = intent.getStringExtra("source");
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ CAN-—à–∏–Ω—É
        sendToCAN(artist, title, album, source);
    }
};
```

**–ß–µ—Ä–µ–∑ CAN-—à–∏–Ω—É:**
```java
// –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ CAN (—á–µ—Ä–µ–∑ –Ω–∞—Ç–∏–≤–Ω—ã–π –∫–æ–¥)
public native void sendMediaMetadataToCAN(
    String artist, 
    String title, 
    String album, 
    String source
);

// C –∫–æ–¥ (JNI)
JNIEXPORT void JNICALL
Java_com_desaysv_meterinteraction_sendMediaMetadataToCAN(
    JNIEnv *env, 
    jobject obj, 
    jstring artist, 
    jstring title, 
    jstring album, 
    jstring source
) {
    // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ CAN —Å–æ–æ–±—â–µ–Ω–∏—è
    can_message_t msg;
    msg.id = MEDIA_METADATA_CAN_ID;
    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ CAN
    can_send(&msg);
}
```

**–ß–µ—Ä–µ–∑ Shared Memory (–¥–ª—è QNX):**
```java
// –ó–∞–ø–∏—Å—å –≤ shared memory –¥–ª—è QNX
MemoryFile memoryFile = new MemoryFile("media_metadata", size);
// –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
// QNX —á–∏—Ç–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–∞ –ø—Ä–∏–±–æ—Ä–Ω–æ–π –ø–∞–Ω–µ–ª–∏
```

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ —Å –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–æ–π

### –ü–æ—á–µ–º—É –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ù–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ SVMedia**
   - –ù–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ "–Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞" –≤ —Å–ø–∏—Å–∫–µ
   - SVMedia –Ω–µ –∑–Ω–∞–µ—Ç –æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏

2. **–ù–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**
   - SVMediaService –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ—Ç –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏
   - –ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ MediaSession –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏

3. **–ù–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ –ø—Ä–∏–±–æ—Ä–Ω—É—é –ø–∞–Ω–µ–ª—å**
   - –î–∞–∂–µ –µ—Å–ª–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã, –æ–Ω–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
   - SVMeterInteraction –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

---

## üí° –†–µ—à–µ–Ω–∏–µ: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è SVMedia (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ "–Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞"

**–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `dialog_source_t1d_my.xml`:**
```xml
<!-- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ -->
<RadioButton
    android:id="@+id/source_yandex_music"
    android:text="–Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞"
    android:checked="false" />
```

**–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:**
```java
// –í MediaMainActivity –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–º –∫–ª–∞—Å—Å–µ
private void onSourceSelected(int sourceId) {
    switch (sourceId) {
        case R.id.source_radio:
            // –†–∞–¥–∏–æ
            break;
        case R.id.source_bluetooth:
            // Bluetooth
            break;
        case R.id.source_carplay:
            // CarPlay
            break;
        case R.id.source_yandex_music:  // –ù–û–í–û–ï
            // –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞
            launchYandexMusic();
            break;
    }
}
```

#### –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ—Ç –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MediaSession API:**
```java
public class YandexMusicMetadataReceiver {
    private MediaController mediaController;
    private MediaController.Callback callback;
    
    public void startListening() {
        // –ü–æ–ª—É—á–µ–Ω–∏–µ MediaSession —Ç–æ–∫–µ–Ω–∞ –æ—Ç –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏
        MediaSessionManager sessionManager = 
            (MediaSessionManager) context.getSystemService(Context.MEDIA_SESSION_SERVICE);
        
        List<MediaController> controllers = sessionManager.getActiveSessions(
            new ComponentName(context, MediaButtonReceiver.class)
        );
        
        // –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏
        for (MediaController controller : controllers) {
            String packageName = controller.getPackageName();
            if ("ru.yandex.music".equals(packageName)) {
                mediaController = controller;
                break;
            }
        }
        
        if (mediaController != null) {
            callback = new MediaController.Callback() {
                @Override
                public void onMetadataChanged(MediaMetadata metadata) {
                    // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
                    String artist = metadata.getString(MediaMetadata.METADATA_KEY_ARTIST);
                    String title = metadata.getString(MediaMetadata.METADATA_KEY_TITLE);
                    String album = metadata.getString(MediaMetadata.METADATA_KEY_ALBUM);
                    
                    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Å–∏—Å—Ç–µ–º—É
                    sendToMeterInteraction(artist, title, album, "yandex_music");
                }
            };
            
            mediaController.registerCallback(callback);
        }
    }
    
    private void sendToMeterInteraction(String artist, String title, String album, String source) {
        Intent intent = new Intent("com.desaysv.mediaservice.TRACK_UPDATE");
        intent.putExtra("artist", artist);
        intent.putExtra("title", title);
        intent.putExtra("album", album);
        intent.putExtra("source", source);
        context.sendBroadcast(intent);
    }
}
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Broadcast Receiver:**
```java
// –ï—Å–ª–∏ –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Broadcast Intent
private BroadcastReceiver yandexMusicReceiver = new BroadcastReceiver() {
    @Override
    public void onReceive(Context context, Intent intent) {
        String artist = intent.getStringExtra("artist");
        String title = intent.getStringExtra("title");
        String album = intent.getStringExtra("album");
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Å–∏—Å—Ç–µ–º—É
        sendToMeterInteraction(artist, title, album, "yandex_music");
    }
};

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
IntentFilter filter = new IntentFilter("ru.yandex.music.METADATA_UPDATE");
context.registerReceiver(yandexMusicReceiver, filter);
```

#### –®–∞–≥ 3: –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏

**–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:**
```java
private void launchYandexMusic() {
    Intent intent = new Intent();
    intent.setComponent(new ComponentName(
        "ru.yandex.music",
        "ru.yandex.music.ui.MainActivity"
    ));
    intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
    startActivity(intent);
    
    // –ù–∞—á–∞—Ç—å –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    yandexMusicMetadataReceiver.startListening();
}
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–ë–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)

#### –ò–¥–µ—è: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–¥–∏–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ MediaSession:**
```java
public class AutoMediaSourceDetector {
    private MediaSessionManager sessionManager;
    private List<MediaController> activeControllers;
    
    public void startMonitoring() {
        sessionManager = (MediaSessionManager) context.getSystemService(
            Context.MEDIA_SESSION_SERVICE
        );
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö MediaSession
        List<MediaController> controllers = sessionManager.getActiveSessions(
            new ComponentName(context, MediaButtonReceiver.class)
        );
        
        // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
        for (MediaController controller : controllers) {
            String packageName = controller.getPackageName();
            
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            if (isSystemApp(packageName)) {
                continue;
            }
            
            // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
            controller.registerCallback(new MediaController.Callback() {
                @Override
                public void onMetadataChanged(MediaMetadata metadata) {
                    String artist = metadata.getString(MediaMetadata.METADATA_KEY_ARTIST);
                    String title = metadata.getString(MediaMetadata.METADATA_KEY_TITLE);
                    String album = metadata.getString(MediaMetadata.METADATA_KEY_ALBUM);
                    
                    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–æ package name
                    String source = getSourceName(packageName);
                    
                    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Å–∏—Å—Ç–µ–º—É
                    sendToMeterInteraction(artist, title, album, source);
                }
            });
        }
    }
    
    private String getSourceName(String packageName) {
        // –ú–∞–ø–ø–∏–Ω–≥ package name –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        switch (packageName) {
            case "ru.yandex.music":
                return "–Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞";
            case "com.spotify.music":
                return "Spotify";
            case "com.google.android.music":
                return "Google Play Music";
            default:
                return packageName; // –ò–ª–∏ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫"
        }
    }
}
```

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ SVMediaService:**
```java
public class SVMediaService extends Service {
    private AutoMediaSourceDetector detector;
    
    @Override
    public void onCreate() {
        super.onCreate();
        detector = new AutoMediaSourceDetector(this);
        detector.startMonitoring();
    }
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI:**
```java
// –í MediaMainActivity
private void updateSourceList() {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–µ–¥–∏–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
    List<String> activeSources = detector.getActiveSources();
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    for (String source : activeSources) {
        addSourceToUI(source);
    }
}
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:

```xml
<!-- AndroidManifest.xml -->
<uses-permission android:name="android.permission.MEDIA_CONTENT_CONTROL"/>
<uses-permission android:name="android.permission.QUERY_ALL_PACKAGES"/>
```

**–í–ê–ñ–ù–û:** `MEDIA_CONTENT_CONTROL` - —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

### –ü–æ–ª—É—á–µ–Ω–∏–µ MediaSession —Ç–æ–∫–µ–Ω–∞:

```java
// Android 5.0+ (API 21+)
MediaSessionManager sessionManager = 
    (MediaSessionManager) context.getSystemService(Context.MEDIA_SESSION_SERVICE);

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
List<MediaController> controllers = sessionManager.getActiveSessions(
    new ComponentName(context, MediaButtonReceiver.class)
);
```

### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:

```java
MediaController.Callback callback = new MediaController.Callback() {
    @Override
    public void onMetadataChanged(MediaMetadata metadata) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    }
    
    @Override
    public void onPlaybackStateChanged(PlaybackState state) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
    }
};

mediaController.registerCallback(callback);
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ SVMeterInteraction:

```java
// –§–æ—Ä–º–∞—Ç Broadcast Intent
Intent intent = new Intent("com.desaysv.mediaservice.TRACK_UPDATE");
intent.putExtra("artist", artist);
intent.putExtra("title", title);
intent.putExtra("album", album);
intent.putExtra("source", source);
intent.putExtra("duration", duration);
intent.putExtra("position", position);
sendBroadcast(intent);
```

---

## üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (1-2 –¥–Ω—è)

1. **–î–µ–∫–æ–º–ø–∏–ª—è—Ü–∏—è SVMedia**
   - –ò–∑—É—á–∏—Ç—å –∫–æ–¥ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
   - –ù–∞–π—Ç–∏ –≥–¥–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
   - –ü–æ–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ SVMeterInteraction

2. **–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏ Broadcast Intent
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å MediaSession API
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ `adb logcat`

3. **–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ SVMeterInteraction**
   - –ù–∞–π—Ç–∏ Broadcast Receiver –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
   - –ü–æ–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç CAN-—Å–æ–æ–±—â–µ–Ω–∏–π
   - –ü–æ–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–ª—è QNX

### –≠—Ç–∞–ø 2: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (3-5 –¥–Ω–µ–π)

1. **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è SVMedia**
   - –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ "–Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞"
   - –ò–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**
   - MediaSession API
   - Broadcast Receiver (–µ—Å–ª–∏ –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ SVMeterInteraction
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ CAN
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ QNX (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 –¥–Ω—è)

1. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ó–∞–ø—É—Å–∫ –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –ø—Ä–∏–±–æ—Ä–Ω–æ–π –ø–∞–Ω–µ–ª–∏

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –†–∞–±–æ—Ç–∞ —Å –¥—Ä—É–≥–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
   - –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥: **–ì–∏–±—Ä–∏–¥–Ω—ã–π**

1. **–î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ "–Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∞"** –≤ UI
   - –ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –Ø–≤–Ω—ã–π –≤—ã–±–æ—Ä

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** –≤ —Ñ–æ–Ω–µ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MediaSession API**
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Android API
   - –†–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ Broadcast Intent
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ SVMeterInteraction

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **MediaSession API:** https://developer.android.com/reference/android/media/session/MediaSession
- **MediaController:** https://developer.android.com/reference/android/media/session/MediaController
- **MediaMetadata:** https://developer.android.com/reference/android/media/MediaMetadata
- **A2DP:** https://developer.android.com/reference/android/bluetooth/BluetoothA2dp

---

**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω, –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ  
**–î–∞—Ç–∞:** 2024  
**–í–µ—Ä—Å–∏—è:** 1.0

