# Анализ логов навигации

## Дата тестирования
2025-11-13 17:00-17:02

## Статистика логов
- **Всего строк:** 29,210
- **NotificationDataManager:** 0 упоминаний
- **Guidance:** 6,854 упоминаний
- **NavigationMonitor:** 15,350 упоминаний
- **BridgeService:** 164 упоминания

## Что работает

### 1. NavigationMonitor
- ✅ Находит `GenericGuidanceComponent.INSTANCE`
- ✅ Получает `GuidanceServicePresenter`
- ✅ Находит `Guidance` в поле `GuidanceServicePresenter.handler`
- ✅ Проверяет валидность Guidance

### 2. Уведомления
- ✅ Навигатор создает уведомление (notification)
- ✅ Категория: `navigation`
- ✅ Package: `ru.yandex.yandexnavi`

## Проблемы

### 1. YandexNavigatorDataExtractor
- ❌ Не видно в логах
- ❌ Не инициализируется или не работает
- ❌ Не может получить `NotificationDataManager`

### 2. NotificationDataManager
- ❌ Нет упоминаний в логах навигатора
- ❌ Не используется напрямую в этой версии
- ❌ Данные передаются через другие механизмы

### 3. Получение данных через Guidance
- ❌ Метод `isValid()` не найден
- ❌ Метод `getCurrentRoute()` не найден
- ❌ Метод `route()` не найден
- ❌ Все методы возвращают `null`

## Найденные классы

### Класс k.java (старая версия)
**Путь:** `ru.yandex.yandexmaps.integrations.auto_navigation.navikit.k`

**Что делает:**
- Получает `NotificationDataManager` в конструкторе:
  ```java
  NotificationDataManager notificationDataManager = guidance.notificationDataManager();
  this.f180940a = notificationDataManager;
  ```
- Использует `notificationData()` для получения данных:
  ```java
  NotificationData notificationData = this.f180940a.notificationData();
  ```
- Подписывается на обновления в `onHandlerReady()`:
  ```java
  this.f180940a.addListener(this.f180941b);
  ```

**Это и есть точка перехвата!**

### Класс a.java (новая версия)
**Путь:** `ru.yandex.yandexmaps.integrations.auto_navigation.navikit.a`

**Что делает:**
- Наследуется от `BaseAutomotiveGuidanceConsumer`
- Получает `Guidance` в конструкторе
- Использует `GuidanceServicePresenter` для работы с уведомлениями

## Точки перехвата данных

### Вариант 1: Модификация класса k.java
**Где:** `ru.yandex.yandexmaps.integrations.auto_navigation.navikit.k`

**Что делать:**
1. В конструкторе после получения `NotificationDataManager`:
   ```java
   NotificationDataManager notificationDataManager = guidance.notificationDataManager();
   this.f180940a = notificationDataManager;
   
   // ДОБАВИТЬ:
   TiggoBridgeSender.getInstance().attachToNotificationDataManager(notificationDataManager);
   ```

2. Или в `onHandlerReady()` после `addListener()`:
   ```java
   this.f180940a.addListener(this.f180941b);
   
   // ДОБАВИТЬ:
   TiggoBridgeSender.getInstance().attachToNotificationDataManager(this.f180940a);
   ```

### Вариант 2: Модификация класса a.java
**Где:** `ru.yandex.yandexmaps.integrations.auto_navigation.navikit.a`

**Что делать:**
1. Найти, где получается `NotificationDataManager`
2. Добавить вызов `TiggoBridgeSender.getInstance().attachToNotificationDataManager()`

### Вариант 3: Перехват через GuidanceServicePresenter
**Где:** `GuidanceServicePresenter.getNotification()`

**Что делать:**
1. Перехватить вызов `getNotification()`
2. Извлечь данные из `GenericGuidanceNotification`
3. Отправить в `TiggoBridgeService`

## Рекомендации

1. **Использовать класс k.java** - он напрямую работает с `NotificationDataManager`
2. **Добавить TiggoBridgeSender** в конструктор или `onHandlerReady()`
3. **Протестировать** модифицированный APK

## Следующие шаги

1. ✅ Найти класс k.java в декомпилированном APK
2. ⏳ Модифицировать его для добавления TiggoBridgeSender
3. ⏳ Ре-скомпилировать APK
4. ⏳ Протестировать

