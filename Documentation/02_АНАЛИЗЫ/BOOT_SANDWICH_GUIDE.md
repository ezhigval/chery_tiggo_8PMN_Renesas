# Руководство: Создание "бутерброда" boot.img

## Концепция

Создаем boot.img, который:

- ✅ **Ядро** - из готового Android образа (совместимо с virt)
- ✅ **Ramdisk** - из готового образа (или адаптированный)
- ✅ **DTB** - для virt машины
- ✅ **System/Vendor/Product** - наши оригинальные (с приложениями)

## Шаг 1: Получить готовый boot.img

### Вариант A: LineageOS (рекомендуется)

1. Перейдите на https://download.lineageos.org/
2. Выберите устройство с ARM64 архитектурой (например, Pixel, OnePlus и т.д.)
3. Скачайте образ (обычно это ZIP файл)
4. Распакуйте и найдите `boot.img`

### Вариант B: Android-x86 (если есть ARM64)

1. Перейдите на https://www.android-x86.org/download
2. Проверьте, есть ли ARM64 версия
3. Скачайте образ и извлеките `boot.img`

### Вариант C: Готовый образ для эмуляции

Поищите готовые Android образы для ARM64 эмуляции в интернете.

## Шаг 2: Создать совместимый boot.img

```bash
cd /Users/valentinezov/Projects/Tiggo/development/scripts
./create_compatible_boot.sh /path/to/downloaded/boot.img
```

Скрипт:

1. Извлечет kernel, ramdisk из готового boot.img
2. Адаптирует cmdline для virt машины
3. Создаст новый boot.img с правильными адресами для virt

## Шаг 3: Использовать в эмуляторе

Созданный boot.img будет в:

```
development/emulator/boot_rebuild/boot_virt.img
```

Используйте его вместо оригинального boot.img:

- В GUI эмулятора укажите путь к новому boot.img
- Или замените оригинальный boot.img (сделайте backup!)

## Шаг 4: Запустить эмулятор

Эмулятор будет использовать:

- ✅ Новый boot.img (ядро для virt)
- ✅ Оригинальный system.img (ваши приложения)
- ✅ Оригинальный vendor.img (драйверы)
- ✅ Оригинальный product.img (приложения)

## Что получится

**"Бутерброд":**

- Верхний слой (boot.img): ядро для virt машины
- Средний слой (ramdisk): адаптированный для virt
- Нижний слой (system/vendor/product): ваши оригинальные образы

**Результат:**

- ✅ Ядро работает с virt машиной
- ✅ Все ваши приложения работают (они в system.img)
- ✅ Все ваши настройки сохраняются
- ✅ Можно тестировать модифицированные приложения

## Устранение проблем

### Ramdisk не работает

Если ramdisk из готового образа не работает:

1. Можно использовать оригинальный ramdisk из вашего boot.img
2. Или создать минимальный ramdisk для virt

### DTB не подходит

DTB будет сгенерирован автоматически для virt машины, или можно использовать готовый из Android образа.

### Приложения не запускаются

Проверьте, что используете оригинальные system.img, vendor.img, product.img - они содержат ваши приложения.

## Альтернатива: Использовать рабочее ядро напрямую

Если не хотите создавать boot.img, можно использовать рабочее ядро напрямую:

```bash
export T18FL3_USE_WORKING_KERNEL=1
export T18FL3_WORKING_KERNEL_PATH=/path/to/kernel
python3 main.py
```

Но создание boot.img дает больше контроля и совместимости.

