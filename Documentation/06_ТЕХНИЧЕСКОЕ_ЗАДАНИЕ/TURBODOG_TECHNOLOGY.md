# TurboDog - Технологии и оптимизации

## Технологии TurboDog

### Платформа и язык программирования

**Основной стек:**
- **Android Java** - для UI и интеграции с системой
- **Native C/C++ (JNI)** - для навигационного движка и рендеринга
- **OpenGL ES** - для графического рендеринга
- **NanoVG** - для векторной графики

### Архитектура

```
┌─────────────────────────────────────┐
│  Android Java Layer                 │
│  - WelcomeActivity                  │
│  - TurboDogGpsService               │
│  - NaviAIDLService                  │
│  - H3NCustomCenter                  │
└──────────────┬──────────────────────┘
               │ JNI
               ▼
┌─────────────────────────────────────┐
│  Native C/C++ Layer                 │
│  - CTurboDogDlg (навигационный      │
│    движок)                          │
│  - TurboDog_CreateGL (OpenGL)       │
│  - TurboDog_CreateNVG (NanoVG)      │
│  - Нативный рендеринг карты         │
└──────────────┬──────────────────────┘
               │ OpenGL ES
               ▼
┌─────────────────────────────────────┐
│  GPU (Hardware Acceleration)        │
│  - Аппаратное ускорение рендеринга  │
│  - OpenGL ES рендеринг              │
└─────────────────────────────────────┘
```

### Ключевые компоненты

#### 1. CTurboDogDlg
- **Язык:** C/C++ (нативный код через JNI)
- **Роль:** Основной навигационный движок
- **Функции:**
  - Обработка GPS данных
  - Построение маршрутов
  - Расчет навигационных данных
  - Управление рендерингом

#### 2. OpenGL (TurboDog_CreateGL)
- **Технология:** OpenGL ES для Android
- **Роль:** Графический рендеринг карты
- **Функции:**
  - Рендеринг тайлов карты
  - Отрисовка маршрута
  - Отрисовка POI и событий
  - Аппаратное ускорение

#### 3. NanoVG (TurboDog_CreateNVG)
- **Технология:** NanoVG (легковесная векторная графика)
- **Роль:** Векторный рендеринг UI элементов
- **Функции:**
  - Отрисовка указателей
  - Отрисовка ограничений скорости
  - Отрисовка элементов интерфейса
  - Легковесный рендеринг

#### 4. SecondaryRenderThread
- **Технология:** Отдельный поток рендеринга
- **Роль:** Рендеринг для второго дисплея (Display 1)
- **Функции:**
  - Независимый рендеринг для Presentation окна
  - Оптимизация производительности
  - Параллельный рендеринг двух дисплеев

### Оптимизации TurboDog

#### 1. Нативный код (JNI)
**Преимущества:**
- Высокая производительность (C/C++)
- Минимальные накладные расходы
- Прямой доступ к системным ресурсам

**Применение:**
- Навигационный движок
- Расчет маршрутов
- Обработка GPS данных
- Рендеринг карты

#### 2. OpenGL ES (Hardware Acceleration)
**Преимущества:**
- Аппаратное ускорение на GPU
- Эффективный рендеринг больших карт
- Поддержка множества объектов

**Применение:**
- Рендеринг тайлов карты
- Отрисовка маршрута (полилинии)
- Отрисовка POI и событий
- Полноэкранный рендеринг

#### 3. NanoVG (Легковесная векторная графика)
**Преимущества:**
- Низкое потребление ресурсов
- Быстрый рендеринг векторных элементов
- Масштабируемая графика

**Применение:**
- UI элементы (указатели, ограничения скорости)
- Векторные иконки
- Текст и подписи
- Упрощенный рендеринг на втором дисплее

#### 4. Многопоточность
**Преимущества:**
- Параллельный рендеринг двух дисплеев
- Неблокирующий UI поток
- Оптимизация CPU/GPU

**Применение:**
- `SecondaryRenderThread` для Display 1
- Основной поток для Display 0
- Отдельные потоки для загрузки тайлов

#### 5. Оптимизация памяти
**Методы:**
- Кеширование тайлов карты
- Освобождение неиспользуемых ресурсов
- Оптимизация текстур

#### 6. Оптимизация батареи
**Методы:**
- Эффективное использование GPS
- Оптимизация обновлений
- Управление частотой рендеринга

### Вызовы для Yandex MapKit

Чтобы достичь аналогичной производительности, нужно:

1. **Использовать нативный рендеринг** (если доступно в MapKit)
2. **Оптимизировать Display 1** - упрощенный режим без детализации
3. **Использовать аппаратное ускорение** MapKit
4. **Минимизировать количество объектов** на упрощенной карте
5. **Оптимизировать обновления** - обновлять только необходимые элементы

### Рекомендации для реализации

1. **Display 0 (полноценный):**
   - Все возможности MapKit
   - Полная детализация карты
   - POI, события, пробки
   - Все слои карты

2. **Display 1 (упрощенный):**
   - Только маршрут (полилинии)
   - Камеры скорости
   - Дорожные события
   - Минимальная детализация карты
   - Отключить лишние слои

3. **Оптимизации:**
   - Разные настройки MapKit для двух дисплеев
   - Минимизация объектов на Display 1
   - Оптимизация частоты обновлений
   - Использование кеширования

